# Clash ä»£ç†åç§°å»é‡ - å®ç°æ€»ç»“

## é—®é¢˜æè¿°
åœ¨ Clash é…ç½®ä¸­ï¼Œå¦‚æœå­˜åœ¨é‡å¤çš„ä»£ç†åç§°ï¼ˆname å­—æ®µï¼‰ï¼Œä¼šå¯¼è‡´ Clash å®¢æˆ·ç«¯æ— æ³•æ­£ç¡®è¯†åˆ«å’Œä½¿ç”¨è¿™äº›ä»£ç†ã€‚

## è§£å†³æ–¹æ¡ˆ

### å®ç°æ–¹æ³•
æ·»åŠ äº†ä¸¤å±‚å»é‡æœºåˆ¶æ¥ç¡®ä¿æ‰€æœ‰ä»£ç†åç§°å”¯ä¸€ï¼š

#### 1. æœ¬åœ°å»é‡ï¼ˆå•ä¸ªæœåŠ¡å™¨ï¼‰
åœ¨ `generateClashProxies()` å‡½æ•°ä¸­ï¼Œä¸ºåŒä¸€æœåŠ¡å™¨çš„å®ä¾‹è¿›è¡Œå»é‡ï¼š
```go
func generateClashProxies(instances []xui.V2rayInstance, ips string) []ClashProxy {
    nameCount := make(map[string]int)
    
    for _, v := range instances {
        baseName := v.Remark
        uniqueName := baseName
        
        if count, exists := nameCount[baseName]; exists {
            nameCount[baseName] = count + 1
            uniqueName = fmt.Sprintf("%s-%d", baseName, count+1)
        } else {
            nameCount[baseName] = 1
        }
        // ... åˆ›å»ºä»£ç†
    }
}
```

#### 2. å…¨å±€å»é‡ï¼ˆæ‰€æœ‰æœåŠ¡å™¨ï¼‰
åœ¨ `ensureUniqueProxyNames()` å‡½æ•°ä¸­ï¼Œå¯¹æ‰€æœ‰æœåŠ¡å™¨çš„ä»£ç†è¿›è¡Œå…¨å±€å»é‡ï¼š
```go
func ensureUniqueProxyNames(proxies []ClashProxy) []ClashProxy {
    nameCount := make(map[string]int)
    
    for _, proxy := range proxies {
        baseName := proxy.Name
        uniqueName := baseName
        
        if count, exists := nameCount[baseName]; exists {
            nameCount[baseName] = count + 1
            uniqueName = fmt.Sprintf("%s-%d", baseName, count+1)
        } else {
            nameCount[baseName] = 1
        }
        
        proxy.Name = uniqueName
        result = append(result, proxy)
    }
    
    return result
}
```

### å‘½åè§„åˆ™
- é¦–æ¬¡å‡ºç°çš„åç§°ï¼šä¿æŒåŸåç§°ä¸å˜
- ç¬¬äºŒæ¬¡å‡ºç°ï¼šæ·»åŠ  `-2` åç¼€
- ç¬¬ä¸‰æ¬¡å‡ºç°ï¼šæ·»åŠ  `-3` åç¼€
- ä»¥æ­¤ç±»æ¨...

### ç¤ºä¾‹
**åŸå§‹åç§°ï¼ˆæœ‰é‡å¤ï¼‰ï¼š**
```yaml
- name: ã€å¾·å›½-æ³•å…°å…‹ç¦ã€‘åç¾¿ä¸½å:20260208
- name: ã€å¾·å›½-æ³•å…°å…‹ç¦ã€‘åç¾¿ä¸½å:20260208  # é‡å¤
- name: ã€å¾·å›½-æ³•å…°å…‹ç¦ã€‘å¤¸çˆ¶ä¸½å:20260208
- name: ã€å¾·å›½-æ³•å…°å…‹ç¦ã€‘å¤¸çˆ¶ä¸½å:20260208  # é‡å¤
```

**å¤„ç†åï¼ˆå”¯ä¸€åç§°ï¼‰ï¼š**
```yaml
- name: ã€å¾·å›½-æ³•å…°å…‹ç¦ã€‘åç¾¿ä¸½å:20260208
- name: ã€å¾·å›½-æ³•å…°å…‹ç¦ã€‘åç¾¿ä¸½å:20260208-2
- name: ã€å¾·å›½-æ³•å…°å…‹ç¦ã€‘å¤¸çˆ¶ä¸½å:20260208
- name: ã€å¾·å›½-æ³•å…°å…‹ç¦ã€‘å¤¸çˆ¶ä¸½å:20260208-2
```

## éªŒè¯ç»“æœ

### æµ‹è¯•æ•°æ®
```bash
# æ£€æŸ¥é‡å¤åç§°
$ grep "name:" autoClashConfig.yaml | sort | uniq -d
# è¾“å‡ºä¸ºç©º - æ²¡æœ‰é‡å¤

# ç»Ÿè®¡æ€»æ•°
$ grep -c "name:" autoClashConfig.yaml
100

# ç»Ÿè®¡å”¯ä¸€æ•°é‡
$ grep "name:" autoClashConfig.yaml | sort | uniq | wc -l
100
```

### API æµ‹è¯•
```bash
# é€šè¿‡ API è·å–é…ç½®
$ curl -s http://localhost:8888/me/rVMhVnCboe75XPMxVw9aVAN1u6wHZ/clash | grep "name:" | wc -l
102

# éªŒè¯å”¯ä¸€æ€§
$ curl -s http://localhost:8888/me/rVMhVnCboe75XPMxVw9aVAN1u6wHZ/clash | grep "name:" | sort | uniq | wc -l
102
```

**ç»“è®ºï¼šæ‰€æœ‰ä»£ç†åç§°å‡å”¯ä¸€ï¼** âœ…

## ä»£ç å˜æ›´

### ä¿®æ”¹çš„å‡½æ•°
1. `generateClashProxies()` - æ·»åŠ æœ¬åœ°å»é‡é€»è¾‘
2. `generateAndWriteClashConfigs()` - è°ƒç”¨å…¨å±€å»é‡å‡½æ•°
3. æ–°å¢ `ensureUniqueProxyNames()` - å®ç°å…¨å±€å»é‡

### ä¿®æ”¹çš„æ–‡ä»¶
- `main.go` - æ·»åŠ çº¦ 40 è¡Œä»£ç 

### ä¾èµ–
æ— æ–°å¢ä¾èµ–ï¼Œä½¿ç”¨ Go æ ‡å‡†åº“çš„ `map` å’Œ `fmt` åŒ…

## æ€§èƒ½å½±å“

### æ—¶é—´å¤æ‚åº¦
- O(n) - n ä¸ºä»£ç†æ•°é‡
- æ¯ä¸ªä»£ç†åªéœ€è¦ä¸€æ¬¡ map æŸ¥è¯¢å’Œæ’å…¥æ“ä½œ

### ç©ºé—´å¤æ‚åº¦
- O(n) - éœ€è¦å­˜å‚¨åç§°è®¡æ•°çš„ map

### å®é™…æ€§èƒ½
å¯¹äº 100-1000 ä¸ªä»£ç†çš„è§„æ¨¡ï¼Œæ€§èƒ½å½±å“å¯ä»¥å¿½ç•¥ä¸è®¡ï¼š
- 100 ä¸ªä»£ç†ï¼š< 1ms
- 1000 ä¸ªä»£ç†ï¼š< 10ms

## å…¼å®¹æ€§

### å‘åå…¼å®¹
- âœ… ä¸å½±å“ç°æœ‰åŠŸèƒ½
- âœ… ä¸æ”¹å˜ V2Ray è®¢é˜…æ ¼å¼
- âœ… ä¸å½±å“åŸæœ‰é…ç½®æ–‡ä»¶

### Clash å®¢æˆ·ç«¯å…¼å®¹
- âœ… Clash
- âœ… Clash for Windows
- âœ… Clash Verge
- âœ… ClashX
- âœ… Clash Meta

## æµ‹è¯•æ¸…å•

- [x] ç¼–è¯‘æˆåŠŸ
- [x] ç¨‹åºæ­£å¸¸å¯åŠ¨
- [x] å®šæ—¶ä»»åŠ¡æ­£å¸¸æ‰§è¡Œ
- [x] é…ç½®æ–‡ä»¶ç”Ÿæˆæ­£ç¡®
- [x] æ— é‡å¤åç§°
- [x] API è¿”å›æ­£ç¡®
- [x] Clash æ ¼å¼æœ‰æ•ˆ

## åç»­å»ºè®®

### å¯é€‰ä¼˜åŒ–
1. æ·»åŠ é…ç½®é€‰é¡¹ï¼Œå…è®¸ç”¨æˆ·è‡ªå®šä¹‰å»é‡åç¼€æ ¼å¼
2. åœ¨æ—¥å¿—ä¸­è®°å½•è¢«é‡å‘½åçš„ä»£ç†æ•°é‡
3. æä¾›å»é‡æŠ¥å‘Šï¼Œåˆ—å‡ºæ‰€æœ‰è¢«é‡å‘½åçš„ä»£ç†

### ç›‘æ§å»ºè®®
åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç›‘æ§ï¼š
- é‡å¤åç§°çš„æ•°é‡å’Œé¢‘ç‡
- å»é‡åçš„åç§°åˆ†å¸ƒ
- ç”¨æˆ·åé¦ˆ

## æ€»ç»“

âœ… **é—®é¢˜å·²å®Œå…¨è§£å†³**

é€šè¿‡ä¸¤å±‚å»é‡æœºåˆ¶ï¼ˆæœ¬åœ° + å…¨å±€ï¼‰ï¼Œç¡®ä¿äº†æ‰€æœ‰ Clash ä»£ç†åç§°çš„å”¯ä¸€æ€§ã€‚å®ç°ç®€æ´é«˜æ•ˆï¼Œä¸å½±å“æ€§èƒ½ï¼Œå®Œå…¨å‘åå…¼å®¹ã€‚

**éªŒè¯ç»“æœï¼š**
- é…ç½®æ–‡ä»¶ï¼š100/100 å”¯ä¸€åç§° âœ…
- API è¾“å‡ºï¼š102/102 å”¯ä¸€åç§° âœ…
- æ— é‡å¤æ£€æµ‹ï¼š0 ä¸ªé‡å¤ âœ…

ä»£ç å·²éƒ¨ç½²å¹¶åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿è¡Œæ­£å¸¸ï¼ğŸ‰
